<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title || 'AI Generate - SAOCLAO' %></title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/public/css/profile.css">
  <link rel="stylesheet" href="/public/css/ai-generate.css">
</head>
<body>
  <div class="glow one"></div>
  <div class="glow two"></div>
  <header class="header">
    <div style="display: flex; align-items: center;">
      <div class="logo">
        <a href="/home">
          <img src="/public/img/saoclao.png" alt="SAOCLAO">
        </a>
      </div>
      <nav class="nav-menu">
        <a href="/home" class="nav-link">
          <i class="fa-solid fa-house"></i>
          <span>Trang chủ</span>
        </a>
        <a href="/playlists" class="nav-link">
          <i class="fa-solid fa-music"></i>
          <span>Playlist</span>
        </a>
        <a href="/likes" class="nav-link">
          <i class="fa-solid fa-heart"></i>
          <span>Đã thích</span>
        </a>
        <a href="/ai" class="nav-link active">
          <i class="fa-solid fa-wand-magic-sparkles"></i>
          <span>AI Generate</span>
        </a>
        <a href="/pro" class="nav-link">
          <i class="fa-solid fa-bolt"></i>
          <span>Try Pro</span>
        </a>
      </nav>
    </div>

    <div class="header-actions">
      <button class="upload-btn" onclick="window.location.href='/upload'">
        <i class="fa-solid fa-cloud-arrow-up"></i>
        <span class="btn-text">Upload</span>
      </button>

      <a href="/users/<%= user.username %>" style="text-decoration: none;">
        <div class="user-avatar">
          <img src="<%= user.avatarUrl || '/public/img/default-avatar.png' %>" alt="<%= user.username %>">
        </div>
      </a>

      <form method="post" action="/logout" style="display:inline; margin-left: 8px;">
        <button type="submit" class="btn-logout">Đăng xuất</button>
      </form>
    </div>
  </header>

  <div class="main-layout">
    <div class="content-area">
      <section class="section">
        <% if (flash) { %>
          <div class="flash <%= flash.type %>"><%= flash.message %></div>
          <script>setTimeout(() => document.querySelector('.flash')?.remove(), 3500);</script>
        <% } %>

        <div class="hero">
          <div class="hero-card">
            <div class="headline">
              <div class="spark"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
              <div>
                <p class="title-hero">AI Composer</p>
                <p class="subtitle">Tiếp nối MIDI hoặc remix từ MP3, sinh ra đoạn nhạc mới độc nhất, đăng thẳng lên SAOCLAO.</p>
              </div>
            </div>
            <div class="chips">
              <span class="chip">5–120 giây</span>
              <span class="chip">MIDI / MP3 / WAV</span>
              <span class="chip">Temperature 0.2–2.0</span>
            </div>

            <form class="ai-form" action="/ai/generate" method="post" enctype="multipart/form-data">
              <div class="form-group" style="margin:0;">
                <label>File MIDI / Audio <span class="required">*</span></label>
                <input type="file" name="file" accept=".mid,.midi,.mp3,.wav,.m4a,.flac,.ogg,audio/*" required style="padding:18px; font-size:16px;">
                <p class="ai-hint">Upload MIDI để tiếp nối, hoặc MP3/WAV để tự chuyển sang MIDI (có thể có sai số). Tối đa 30MB.</p>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Thời lượng mong muốn (giây)</label>
                  <input type="number" name="seconds" min="5" max="120" value="30" step="1" required style="padding:16px; font-size:16px;">
                  <p class="ai-hint">Đoạn sinh ra sẽ dài xấp xỉ giá trị này.</p>
                </div>
                <div class="form-group">
                  <label>Temperature</label>
                  <input type="number" name="temperature" min="0.2" max="2.0" step="0.1" value="1.0" required style="padding:16px; font-size:16px;">
                  <p class="ai-hint">0.2 an toàn, 2.0 sáng tạo.</p>
                </div>
              </div>
              <div class="cta-row">
                <button type="submit" class="btn btn-primary">
                  <i class="fa-solid fa-wand-magic-sparkles"></i> Tạo nhạc ngay
                </button>
                <button type="button" class="btn btn-ghost" onclick="window.location.href='/upload'">
                  <i class="fa-solid fa-cloud-arrow-up"></i> Upload thủ công
                </button>
              </div>
            </form>
          </div>

          <div class="hero-card">
            <h3 style="margin-top:0;">Quy trình thực hiện</h3>
            <div class="steps">
              <div class="step"><strong>Bước 1.</strong> Nhận file → chuyển audio thành MIDI (nếu cần).</div>
              <div class="step"><strong>Bước 2.</strong> Model TF sinh continuation theo tempo/temperature.</div>
              <div class="step"><strong>Bước 3.</strong> Render bằng soundfont → MP3 → đăng track.</div>
            </div>
          </div>

          <div class="hero-card">
            <h3 style="margin-top:0;"><i class="fa-solid fa-lightbulb"></i> Mẹo tạo hay</h3>
            <ul class="aside-list">
              <li><i class="fa-solid fa-wave-square"></i> Chọn MIDI ít nhạc cụ, giai điệu rõ.</li>
              <li><i class="fa-solid fa-gauge-high"></i> Tăng temperature cho ý tưởng lạ, giảm để an toàn.</li>
              <li><i class="fa-solid fa-hourglass-half"></i> Giữ độ dài 5–20s lúc thử nghiệm để phản hồi nhanh.</li>
              <li><i class="fa-solid fa-shapes"></i> Nếu render lỗi, kiểm tra `AI_MODEL_PATH` và `SOUNDFONT_PATH` trên server AI.</li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <div class="resize-handle" id="resizeHandle"></div>
    <aside class="right-sidebar" id="rightSidebar">
      <h3 class="sidebar-title">Gợi ý</h3>
      <p style="color:#b3b3b3; line-height:1.6; font-size:14px;">
        - Dùng MIDI piano đơn giản để AI tiếp nối.<br>
        - Với MP3, AI sẽ tự tách và chuyển MIDI trước khi sinh nhạc mới.<br>
        - Nếu lỗi model/soundfont, kiểm tra cấu hình AI service.
      </p>
    </aside>
  </div>
</body>
</html>

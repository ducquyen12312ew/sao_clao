<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stream profile music | SoundCloud</title>
  <link rel="stylesheet" href="/css/topbar.css" />
  <link rel="stylesheet" href="/css/profile.css" />
  <script defer src="/js/profile.js"></script>
</head>
<body>
<%
  const sessionUser = currentUser || user || {};
  const likesFromServer = typeof likes !== "undefined" ? likes : [];
  const likesData = Array.isArray(likesFromServer) && likesFromServer.length
    ? likesFromServer
    : [
      { title: "Rokudenashi - Tada koe hitotsu (Taste...)", by: "Taste", plays: "583K", likes: "8,667", comments: "222" },
      { title: "GETCHA LOVE - Mable & VDT ft.Snow...", by: "Malb", plays: "858K", likes: "4,764", comments: "71" },
      { title: "Obito Ft. Hnhngan Live YOUR SMILE - ...", by: "Hnhngan", plays: "18.7M", likes: "97.3K", comments: "2,586" }
    ];

  const profile = {
    displayName: (profileUser && profileUser.name) || (profileUser && profileUser.username) || "Tiep Kun",
    fullName: (profileUser && profileUser.username) || "Nguyen Tiep",
    location: (profileUser && profileUser.bio) || "Manchester City, United Kingdom",
    followers: (profileUser && profileUser.followersCount) || 0,
    following: (profileUser && profileUser.followingCount) || 0,
    tracks: (typeof tracks !== "undefined" && tracks ? tracks.length : (profileUser && profileUser.tracksCount) || 0),
    likesCount: likesData.length || 3,
    language: "English (US)",
    username: (profileUser && profileUser.username) || sessionUser.username || "guest",
    avatarUrl: (profileUser && profileUser.avatarUrl) || sessionUser.avatarUrl || ""
  };

  const tabs = ["All", "Popular tracks", "Tracks", "Albums", "Playlists", "Reposts"];

  const mapTrack = (t) => ({
    title: t.title || "Untitled",
    artist: t.artist || profile.displayName || "Unknown",
    plays: t.playCount ? t.playCount.toLocaleString() : "",
    likes: t.likes ? t.likes.toLocaleString() : "",
    reposts: t.reposts ? t.reposts.toLocaleString() : "",
    comments: t.comments ? t.comments.toLocaleString() : "",
    time: t.createdAt ? new Date(t.createdAt).toLocaleDateString() : "",
    tag: (t.genres && t.genres.length) ? `# ${t.genres[0]}` : "",
    coverUrl: t.coverUrl || "https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=300&auto=format&fit=crop"
  });

  const recentTracks = (tracks && tracks.length
    ? tracks.map(mapTrack)
    : [
      { title: "GETCHA LOVE - Mable & VDT ft.SnowzyBoy", artist: "Malb", plays: "858K", likes: "4,764", reposts: "71", comments: "36", time: "3 years ago", tag: "# R&B & Soul", coverUrl: "https://images.unsplash.com/photo-1494232410401-ad00d5433cfa?w=300&auto=format&fit=crop" },
      { title: "Viet nam mees", artist: "Tiep Kun", plays: "", likes: "", reposts: "", comments: "", time: "3 years ago", tag: "", coverUrl: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=300&auto=format&fit=crop" },
      { title: "None", artist: "Tiep Kun", plays: "", likes: "", reposts: "", comments: "", time: "3 years ago", tag: "", coverUrl: "https://images.unsplash.com/photo-1519677100203-a0e668c92439?w=300&auto=format&fit=crop" }
    ]);

  const popularList = [
    { idx: 1, who: "Hnhngan", title: "Obito Ft. Hnhngan Live YOUR SMILE - Emma X Seachains X O...", plays: "18.7M" },
    { idx: 1, who: "Soraiz From Southside", title: "Answer Me - Sad Heartbreaking Piano Violin Ra...", plays: "15.2K" },
    { idx: 2, who: "Jurrivh", title: "Hurt - Sad Heartbreaking Crying Depressing Piano", plays: "31.7K" },
    { idx: 3, who: "Dr.M", title: "Only You - Soft Emotional Guitar Rap Beat [Prod- EDOBY]", plays: "53.4K" },
    { idx: 4, who: "Vexento", title: "Lotus", plays: "77.1K" },
    { idx: 5, who: "Vexento", title: "Vexento - Lonely Dance", plays: "740K" }
  ];

  const footerLinks = ["Legal","Privacy","Cookie Policy","Cookie Manager","Imprint","Artist Resources","Newsroom","Charts","Transparency Reports"];
%>

<!-- TOP NAV (match site header) -->
<%- include('partials/topbar', { currentUser: sessionUser, activePage: 'profile' }) %>

<!-- PAGE -->
<main class="page">
  <div class="wrap">
    <!-- PROFILE BANNER -->
    <section class="profile-banner">
      <button class="btn upload-btn" type="button">Upload header image</button>
      <div class="banner-body">
        <div class="avatar-large">
          <% if (profile.avatarUrl) { %>
            <img src="<%= profile.avatarUrl %>" alt="<%= profile.displayName %>">
          <% } else { %>
            <%= (profile.username || profile.displayName || 'H').charAt(0).toUpperCase() %>
          <% } %>
        </div>
        <div class="banner-meta">
          <span class="badge badge--name"><%= profile.displayName %></span>
          <span class="badge"><%= profile.fullName %></span>
          <span class="badge"><%= profile.location %></span>
        </div>
      </div>
    </section>

    <!-- TABS + ACTIONS -->
    <section class="tabs-row" aria-label="Profile navigation">
      <div class="tabs">
        <% tabs.forEach((t, i) => { %>
          <button class="tab <%= i === 0 ? "tab--active" : "" %>" type="button"><%= t %></button>
        <% }) %>
      </div>
      <div class="tab-actions">
        <button class="btn btn--ghost" type="button">Share</button>
        <button class="btn btn--ghost" type="button">Edit</button>
      </div>
    </section>

    <!-- CONTENT GRID -->
    <section class="grid">
      <!-- MAIN -->
      <div class="main">
        <div class="sectionTitleRow">
          <h2 class="h2">Recent</h2>
        </div>

        <% recentTracks.forEach((tr, idx) => { %>
          <article class="trackCard" data-track="<%= idx %>">
            <div class="cover">
              <img src="https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=300&auto=format&fit=crop" alt="<%= tr.title %> cover">
              <button class="playBtn" type="button" aria-label="Play">
                <span class="playIcon" aria-hidden="true"></span>
              </button>
            </div>

            <div class="trackBody">
              <div class="trackTop">
                <div>
                  <div class="trackTitle__main"><%= tr.title %></div>
                  <div class="trackTitle__sub">
                    <span class="muted"><%= tr.artist %></span>
                    <% if (tr.time) { %><span class="dot">.</span><span class="muted"><%= tr.time %></span><% } %>
                    <% if (tr.tag) { %><span class="dot">.</span><span class="tag"><%= tr.tag %></span><% } %>
                  </div>
                </div>
                <button class="btn btn--ghost btn--icon" type="button" aria-label="More">
                  <span class="more-dots" aria-hidden="true"></span>
                </button>
              </div>

              <div class="waveRow">
                <div class="wave" aria-hidden="true"></div>
              </div>

              <div class="trackStats">
                <% if (tr.plays) { %>
                  <span class="stat"><span class="ico ico--play"></span><%= tr.plays %></span>
                <% } %>
                <% if (tr.likes) { %>
                  <span class="stat stat--like"><span class="ico ico--heart"></span><%= tr.likes %></span>
                <% } %>
                <% if (tr.reposts) { %>
                  <span class="stat"><span class="ico ico--repost"></span><%= tr.reposts %></span>
                <% } %>
                <% if (tr.comments) { %>
                  <span class="stat"><span class="ico ico--comment"></span><%= tr.comments %></span>
                <% } %>
                <span class="stat"><span class="ico ico--share"></span>Share</span>
                <span class="stat"><span class="ico ico--more"></span>More</span>
              </div>
            </div>
          </article>
        <% }) %>

        <div class="listBlock">
          <div class="listHeader">Popular tracks</div>

          <div class="miniList">
            <% popularList.forEach((it) => { %>
              <div class="miniRow">
                <div class="miniIdx"><%= it.idx %></div>
                <div class="miniMain">
                  <div class="miniTitle"><span class="miniWho"><%= it.who %></span> . <span class="miniSong"><%= it.title %></span></div>
                </div>
                <div class="miniPlays"><%= it.plays %></div>
              </div>
            <% }) %>
          </div>
        </div>
      </div>

      <!-- SIDEBAR -->
      <aside class="side" aria-label="Sidebar">
        <div class="statsBox">
          <div class="statsCol">
            <div class="statsNum"><%= profile.followers %></div>
            <div class="statsLab">Followers</div>
          </div>
          <div class="statsCol">
            <div class="statsNum"><%= profile.following %></div>
            <div class="statsLab">Following</div>
          </div>
          <div class="statsCol">
            <div class="statsNum"><%= profile.tracks %></div>
            <div class="statsLab">Tracks</div>
          </div>
        </div>

        <div class="likesBox">
          <div class="likesTitle"><%= profile.likesCount %> LIKES</div>
          <% likesData.forEach((l) => { %>
            <div class="likeRow">
              <div class="likeThumb"></div>
              <div class="likeText">
                <div class="likeName"><%= l.title %></div>
                <div class="likeBy"><%= l.by %></div>
                <div class="likeMeta">
                  <span class="likeStat"><span class="ico ico--play"></span><%= l.plays %></span>
                  <span class="likeStat"><span class="ico ico--heart"></span><%= l.likes %></span>
                  <span class="likeStat"><span class="ico ico--comment"></span><%= l.comments %></span>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      </aside>
    </section>
  </div>
</main>

<!-- BOTTOM PLAYER (static) -->
<div class="player" role="contentinfo">
  <div class="wrap player__in">
    <button class="playerBtn" type="button" aria-label="Play/Pause"></button>
    <div class="playerInfo">
      <div class="playerNow">Now playing</div>
      <div class="playerTitle" id="playerTitle">-</div>
    </div>
    <div class="playerBar" aria-hidden="true">
      <div class="playerProg"></div>
    </div>
    <div class="playerTime muted">0:00</div>
  </div>
</div>

<footer class="foot">
  <div class="wrap foot__in">
    <nav class="footLinks" aria-label="Footer">
      <% footerLinks.forEach((t, i) => { %>
        <a href="#"><%= t %></a><% if (i !== footerLinks.length - 1) { %><span class="sep">.</span><% } %>
      <% }) %>
    </nav>
  </div>
</footer>

</body>
</html>
